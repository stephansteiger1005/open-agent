version: '3.8'

services:
  mcp-viewing:
    build:
      context: .
      dockerfile: Dockerfile
    image: mcp-viewing:latest
    container_name: mcp-viewing
    ports:
      - "8080:8080"  # REST API
      - "9000:9000"  # MCP Server
    environment:
      # Spring Boot Configuration
      - SPRING_APPLICATION_NAME=mcp-viewing
      - SERVER_PORT=8080
      
      # Database Configuration (in-memory for demo, use volume for persistence)
      - SPRING_DATASOURCE_URL=jdbc:derby:memory:PARTINFODB;create=true
      - SPRING_DATASOURCE_DRIVER_CLASS_NAME=org.apache.derby.jdbc.EmbeddedDriver
      
      # MCP Server Configuration
      - MCP_SERVER_ENABLED=true
      - MCP_SERVER_PORT=9000
      - MCP_SERVER_MODE=socket
      
      # JVM Options
      - JAVA_OPTS=-Xms256m -Xmx512m
      
      # Logging
      - LOGGING_LEVEL_COM_MCPVIEWING=DEBUG
    
    # Optional: Persistent database
    # volumes:
    #   - ./data:/app/data
    # environment:
    #   - SPRING_DATASOURCE_URL=jdbc:derby:/app/data/PARTINFODB;create=true
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/actuator/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 40s
    
    networks:
      - mcp-network

networks:
  mcp-network:
    driver: bridge

# Optional: Persistent volume for database
# volumes:
#   derby-data:
